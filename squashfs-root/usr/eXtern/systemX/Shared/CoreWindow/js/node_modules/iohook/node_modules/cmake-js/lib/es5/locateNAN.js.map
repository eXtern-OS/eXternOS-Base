{"version":3,"names":[],"mappings":"","sources":["locateNAN.js"],"sourcesContent":["\"use strict\";\r\nlet Promise = require(\"bluebird\");\r\nlet fs = require(\"fs-extra\");\r\nlet path = require(\"path\");\r\nlet async = Promise.coroutine;\r\nlet _ = require(\"lodash\");\r\n\r\nlet isNANModule = async(function* (dir) {\r\n    let h = path.join(dir, \"nan.h\");\r\n    try {\r\n        let stat = yield fs.stat(h);\r\n        return stat.isFile();\r\n    }\r\n    catch (e) {\r\n        _.noop(e);\r\n        return false;\r\n    }\r\n});\r\n\r\nlet isNodeJSProject = async(function* (dir) {\r\n    let pjson = path.join(dir, \"package.json\");\r\n    let node_modules = path.join(dir, \"node_modules\");\r\n    try {\r\n        let stat = yield fs.stat(pjson);\r\n        if (stat.isFile()) {\r\n            return true;\r\n        }\r\n        stat = yield fs.stat(node_modules);\r\n        if (stat.isDirectory()) {\r\n            return true;\r\n        }\r\n    }\r\n    catch (e) {\r\n        _.noop(e);\r\n    }\r\n    return false;\r\n});\r\n\r\nlet locateNAN = module.exports = async(function* (projectRoot) {\r\n    if (locateNAN.__projectRoot) {\r\n        projectRoot = locateNAN.__projectRoot;\r\n    }\r\n    let result = yield isNodeJSProject(projectRoot);\r\n    if (!result) {\r\n        return null;\r\n    }\r\n    let nanModulePath = path.join(projectRoot, \"node_modules\", \"nan\");\r\n    result = yield isNANModule(nanModulePath);\r\n    if (result) {\r\n        return nanModulePath;\r\n    }\r\n\r\n    // Goto upper level:\r\n    return yield locateNAN(goUp(projectRoot));\r\n});\r\n\r\nfunction goUp(dir) {\r\n    let items = dir.split(path.sep);\r\n    let scopeItem = items[items.length - 2];\r\n    if (scopeItem && scopeItem[0] === \"@\") {\r\n        // skip scope\r\n        dir = path.join(dir, \"..\");\r\n    }\r\n    dir = path.join(dir, \"..\", \"..\");\r\n    return path.normalize(dir);\r\n}\r\n"],"file":"locateNAN.js"}